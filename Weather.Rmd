---
title: "Weather"
author: "Maxwel Coura Oliveira"
date: "10/7/2021"
output: html_document
---

```{r}
library(tidyverse) # Data wrangling
library(lubridate) # Dates operations
library(daymetr)
library(chirps)
library(patchwork)
library(ggtext)
library(nasapower)
library(vegan)
```


```{r}
# your data
df_time <- tibble(ID = c('1','2'), 
                  Site = c('Lancaster','Brooklyn'),
                  # Both coordinates in decimal format
                  latitude = c(42.83, 42.52),
                  longitude = c(-90.76, -89.23),
                  Start = c('1989-01-01','1989-01-01'),
                  End = c('2020-12-31','2020-12-31')) %>% 
            mutate_at(5:6, ymd) # as date
```



## Daymet 

```{r function}
source("weather_daymet.R")
```



```{r get_data}
#dpp default = 0 - dpp = days prior start date
df_daymet <- weather_daymet(input = df_time, dpp = 0) 
```


```{r}
df_daymet %>% 
  janitor::clean_names() %>% 
  mutate(month_lab = month(date, label = TRUE)) -> weather
```


```{r}
weather %>% 
  filter(month %in% c(5, 6, 7, 8, 9, 10)) %>% 
  mutate(year = as.character(year),
         highlight = ifelse(year %in% c("2019", "2020"), TRUE, FALSE),
         variable = if_else(highlight == TRUE, year, "NA")) -> weather1
```


```{r}
weather1 %>% 
  filter(year %in% c(2019, 2020)) %>% 
  group_by(site, year, month) %>% 
  summarise(prec = sum(pp), tmax = mean(tmax), tmin = mean(tmin), tmean = mean(tmean)) %>% 
  mutate_if(is.double, ~round(., 1)) -> weather2
```


```{r}
weather2 |> 
  group_by(month) |> 
  summarise(tmean = mean(tmean))
```

